<div class="container mt-4">
  <h3 class="title">{{ title }}</h3>

  <div class="search-container">
    <input
      type="text"
      class="form-control mb-2"
      [(ngModel)]="searchQuery"
      placeholder="Caută produs..."
      (input)="applyFilter($event)"
    />
  </div>

  <div class="table-responsive">
    <table class="table table-bordered table-hover">
      <thead>
        <tr>
          <th class="sortable" (click)="sortData('productName')">
            Nume produs
            <i class="fas fa-sort"></i>
          </th>
          <th class="sortable" (click)="sortData('productCategory')">
            Categorie
            <i class="fas fa-sort"></i>
          </th>
          <th class="sortable" (click)="sortData('priceAtAdd')">
            Preț (EUR)
            <i class="fas fa-sort"></i>
          </th>
          <th>Șterge</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let cartProduct of items">
          <td>{{ cartProduct.productName }}</td>
          <td>{{ cartProduct.productCategory }}</td>
          <td>{{ cartProduct.priceAtAdd }}</td>
          <td class="remove-item-container">
            <button
              class="remove-item-cart"
              (click)="deleteProductFromCart(cartProduct.id)"
            >
              X
            </button>
          </td>
        </tr>
        <tr *ngIf="items.length === 0">
          <td colspan="5" class="text-center">Nu există comenzi</td>
        </tr>
      </tbody>
    </table>
  </div>
  <form
    *ngIf="items.length !== 0"
    [formGroup]="deliveryForm"
    (ngSubmit)="onSubmit()"
    class="form-container"
  >
    <div class="form-row">
      <div class="form-group">
        <label for="fullName">Nume complet:</label>
        <input id="fullName" formControlName="fullName" class="form-input" />
        <div
          class="error-container"
          *ngIf="
            deliveryForm.get('fullName')?.invalid &&
            deliveryForm.get('fullName')?.touched
          "
        >
          <div class="error">
            <small *ngIf="deliveryForm.get('fullName')?.errors?.['required']"
              >Numele este obligatoriu</small
            >
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="email">Email:</label>
        <input
          id="email"
          formControlName="email"
          type="email"
          class="form-input"
        />
        <div
          class="error-container"
          *ngIf="
            deliveryForm.get('email')?.invalid &&
            deliveryForm.get('email')?.touched
          "
        >
          <div class="error">
            <small *ngIf="deliveryForm.get('email')?.errors?.['required']"
              >Emailul este obligatoriu</small
            >
            <small *ngIf="deliveryForm.get('email')?.errors?.['email']"
              >Format invalid.</small
            >
          </div>
        </div>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label for="phone">Număr de telefon:</label>
        <input id="phone" formControlName="phone" class="form-input" />
        <div
          class="error-container"
          *ngIf="
            deliveryForm.get('phone')?.invalid &&
            deliveryForm.get('phone')?.touched
          "
        >
          <div class="error">
            <small *ngIf="deliveryForm.get('phone')?.errors?.['required']"
              >Numărul este obligatoriu</small
            >
            <small *ngIf="deliveryForm.get('phone')?.errors?.['pattern']"
              >Număr invalid</small
            >
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="address">Adresă:</label>
        <input id="address" formControlName="address" class="form-input" />
        <div
          class="error-container"
          *ngIf="
            deliveryForm.get('address')?.invalid &&
            deliveryForm.get('address')?.touched
          "
        >
          <div class="error">
            <small *ngIf="deliveryForm.get('address')?.errors?.['required']"
              >Adresa este obligatorie</small
            >
          </div>
        </div>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label for="city">Oraș:</label>
        <input id="city" formControlName="city" class="form-input" />
        <div
          class="error-container"
          *ngIf="
            deliveryForm.get('city')?.invalid &&
            deliveryForm.get('city')?.touched
          "
        >
          <div class="error">
            <small *ngIf="deliveryForm.get('city')?.errors?.['required']"
              >Orașul este obligatoriu</small
            >
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="postalCode">Cod poștal:</label>
        <input
          id="postalCode"
          formControlName="postalCode"
          class="form-input"
        />
        <div
          class="error-container"
          *ngIf="
            deliveryForm.get('postalCode')?.invalid &&
            deliveryForm.get('postalCode')?.touched
          "
        >
          @if(deliveryForm.get('postalCode')?.invalid &&
          deliveryForm.get('postalCode')?.touched){
          <div class="error">
            <small *ngIf="deliveryForm.get('postalCode')?.errors?.['required']"
              >Codul poștal este obligatoriu</small
            >
            <small *ngIf="deliveryForm.get('postalCode')?.errors?.['pattern']"
              >Cod poștal invalid</small
            >
          </div>
          }@else{
          <div class="error">
            <small></small>
            <small></small>
          </div>
          }
        </div>
      </div>
    </div>
  </form>

  <div *ngIf="items.length !== 0" class="action-buttons">
    <button
      class="submit-button"
      (click)="onSubmit()"
      [disabled]="deliveryForm.invalid"
    >
      <i class="fas fa-check"></i>
      Plasează comandă
    </button>
  </div>
</div>
